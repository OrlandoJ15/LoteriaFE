import{t as ge,j as e,r as s,L as P,I as Z,R as Ne,M as Ue,S as x,K as C,O as ye,P as we,Q as Re,N as B}from"./index-BM2Wk8gr.js";import{I as n,j as G,M as L,k as Ie}from"./InputGeneral-CUzjRp7w.js";import{A as ze,E as Se,D as De}from"./Edit-Cm45UK50.js";const ke=ge(e.jsx("path",{d:"M2 17h20v2H2zm1.15-4.05L4 11.47l.85 1.48 1.3-.75-.85-1.48H7v-1.5H5.3l.85-1.47L4.85 7 4 8.47 3.15 7l-1.3.75.85 1.47H1v1.5h1.7l-.85 1.48zm6.7-.75 1.3.75.85-1.48.85 1.48 1.3-.75-.85-1.48H15v-1.5h-1.7l.85-1.47-1.3-.75L12 8.47 11.15 7l-1.3.75.85 1.47H9v1.5h1.7zM23 9.22h-1.7l.85-1.47-1.3-.75L20 8.47 19.15 7l-1.3.75.85 1.47H17v1.5h1.7l-.85 1.48 1.3.75.85-1.48.85 1.48 1.3-.75-.85-1.48H23z"}),"Password"),Ae=[{title:"Codigo",field:"id"},{title:"Nombre",field:"nombre"},{title:"Nombre De Usuario",field:"nombreUsuario"},{title:"Rol",field:"rol",type:"numeric"},{title:"Correo",field:"correo"}],Me="https://multiplicados-fnf2edgqbuffbpgj.ukwest-01.azurewebsites.net/Usuario/RecUsuario",Pe="https://multiplicados-fnf2edgqbuffbpgj.ukwest-01.azurewebsites.net/Usuario/RecUsuario",Be="https://multiplicados-fnf2edgqbuffbpgj.ukwest-01.azurewebsites.net/Usuario/RecUsuario",Le="https://multiplicados-fnf2edgqbuffbpgj.ukwest-01.azurewebsites.net/Usuario/RecUsuario",Fe="https://multiplicados-fnf2edgqbuffbpgj.ukwest-01.azurewebsites.net/Usuario/RecUsuario",qe="https://multiplicados-fnf2edgqbuffbpgj.ukwest-01.azurewebsites.net/Usuario/RecUsuario",$e="https://multiplicados-fnf2edgqbuffbpgj.ukwest-01.azurewebsites.net/Usuario/RecUsuario",Te=()=>{const l={campo:"",valido:null},[c,v]=s.useState(l),[d,f]=s.useState(l),[u,E]=s.useState(l),[m,j]=s.useState({campo:0,valido:null}),[p,g]=s.useState(l),[h,N]=s.useState(l),[F,W]=s.useState(l),[U,ee]=s.useState(l),[q,T]=s.useState(!1),[y,w]=s.useState([]),[Q,oe]=s.useState(!1),[O,ae]=s.useState(!1),[V,re]=s.useState(!1),[X,se]=s.useState(!1),t={Id:/^[0-9]*$/,Nombre:/^[a-zA-Z0-9_-\s]{1,40}$/,NombreUsuario:/^[a-zA-Z0-9_-\s]{1,40}$/,Rol:/^[1-9]$/,Correo:/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/,Clave:/^(?=(?:.*[A-Za-z]){4,})(?=.*[A-Z])(?=(?:.*\d){4,})[A-Za-z\d]{8,}$/},te=()=>{v(l),f(l),E(l),j({campo:0,valido:null}),g(l),N(l)},ne=o=>o.every(a=>a.valido==="true"),$=(o,a,r)=>{o.preventDefault(),ne(r)?(T(!0),te(),a()):T(!1)},le=o=>$(o,de,[c,d,u,m,p,h]),ie=o=>$(o,ue,[c,d,u,m,p]),ce=o=>$(o,pe,[h,F,U]),_=async(o,a,r,i,b)=>{try{const M=await C.post(o,a);if(b==="id"){if(M.data===null)return;r({campo:"",valido:"false"}),x.fire({icon:"error",title:"Cuidado",text:i})}else if(b==="clave")if(M.data===null)r({campo:"",valido:"null"}),x.fire({icon:"error",title:"Cuidado",text:i});else return}catch(M){console.error("Error:",M)}},J=()=>{const o={id:c.campo,nombre:"",nombreUsuario:"",rol:0,correo:"",clave:""};_(Fe,o,v,"Código Usuario Existente, Intente Nuevamente","id")},K=()=>{const o={id:c.campo,nombre:"",nombreUsuario:"",rol:0,correo:"",clave:h.campo};_(qe,o,N,"Contraseña incorrecta, Intente Nuevamente","clave")},de=()=>R("Desea Guardar Los Cambios?",be),ue=()=>R("Desea Editar Los Cambios?",he),me=()=>R("Desea Eliminar Los Cambios?",xe),pe=()=>R("Desea Cambiar la Contraseña?",Ce),R=(o,a)=>{x.fire({title:o,showDenyButton:!0,confirmButtonText:"Confirmar",denyButtonText:"Cancelar"}).then(r=>{r.isConfirmed?(x.fire("Operacion Exitosa","","success"),a()):r.isDenied&&x.fire("Cambios No Guardados","","info")})},be=async()=>{const o=B();if(!o)return;const a={Id:c.campo,Nombre:d.campo,NombreUSuario:u.campo,Rol:m.campo,Correo:p.campo,Clave:h.campo};try{const r=await C.post(Pe,a,{headers:{Authorization:`Bearer ${o}`}});w([...y,r.data]),I()}catch(r){console.error("Error en la peticion Post: ",r)}},he=async()=>{const o=B();if(!o)return;console.log("este es el token ",o);const a={id:c.campo,nombre:d.campo,nombreUsuario:u.campo,rol:m.campo,correo:p.campo};try{const r=await C.put(Be,a,{headers:{Authorization:`Bearer ${o}`}}),i=y.map(b=>b.id===a.id?a:b);w(i),z()}catch(r){console.error("Error En La Peticion Put: ",r)}},xe=async()=>{const o=B();if(!o)return;const a=c.campo,r={headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`},data:JSON.stringify(a)};try{await C.delete(Le,r),w(y.filter(i=>i.Id!==c.campo)),S(),Y()}catch(i){console.error("Error Al Eliminar Usuario: ",i)}},H=async(o,a)=>{const r=Object.values(...o);v({campo:r[0],valido:"true"}),f({campo:r[1],valido:"true"}),E({campo:r[2],valido:"true"}),j({campo:r[3],valido:"true"}),g({campo:r[4],valido:"true"}),a==="Editar"?z():a==="Eliminar"?S():D()},Y=async()=>{try{const o=await C.get(Me,{withCredentials:!0});w(o.data),console.log("Datos Recibidos: ",o.data)}catch(o){o.response?(console.error("Error de respuesta del servidor:",o.response.status,o.response.data),o.response.status===401&&console.warn("No autorizado. Redirigiendo al login...")):o.request?console.error("Error en la solicitud:",o.request):console.error("Error al configurar la solicitud:",o.message)}};s.useEffect(()=>{Y()},[]);const Ce=async()=>{const o=B();if(!o)return;function a(){x.fire({icon:"error",title:"Cuidado",text:"No fue posible actualizar la contrasena"})}function r(){x.fire({icon:"success",title:"Exitos",text:"Contrasena Actualizada Exitosamente"})}const i={Id:c.campo,Clave:U.campo,Rol:0,Nombre:"",NombreUsuario:"",Correo:""};try{(await C.put($e,i,{headers:{Authorization:`Bearer ${o}`}})).status===200?(r(),D()):a()}catch(b){console.error("Error al actualizar la contraseña:",b),a()}},I=()=>{oe(!Q)},z=()=>{ae(!O)},S=()=>{re(!V)},D=()=>{se(!X)},k={width:"70%",height:"100%",overflowX:"hidden",overflowY:"scroll",position:"relative",backgroundColor:"rgb(255, 255, 255)"},A=({titulo:o,formularioValido:a,onCancel:r,onSubmit:i})=>e.jsxs(e.Fragment,{children:[a===!1&&e.jsx(ye,{children:e.jsxs("p",{children:[e.jsx(we,{icon:Ie}),e.jsx("b",{children:"Error:"})," Por favor rellena el formulario correctamente."]})}),a===!0&&e.jsx(Re,{children:"Campos llenos exitosamente!"}),e.jsxs("div",{align:"right",children:[e.jsx(G,{color:"success",onClick:r,children:"Cancelar"}),e.jsx(G,{color:"primary",onClick:i,type:"submit",children:o})]})]}),ve=e.jsxs("div",{style:k,children:[e.jsx("h3",{children:"Incluir Usuario v2"}),e.jsxs("div",{className:"relleno-general",children:[" ","General",e.jsx("div",{className:"container-fluid",children:e.jsx(P,{children:e.jsxs(Z,{children:[e.jsx(n,{estado:c,cambiarEstado:v,tipo:"text",label:"Id Usuario",placeholder:"Introduzca Id Del Usuario",name:"Id",leyendaError:"El Id Del Usuario solo puede contener numeros.",expresionRegular:t.Id,onChange:J,onBlur:J,autofocus:!0}),e.jsx(n,{estado:d,cambiarEstado:f,tipo:"text",label:"Nombre",placeholder:"Introduzca El Nombre",name:"Nombre",leyendaError:"El Nombre solo puede contener letras y espacios.",expresionRegular:t.Nombre}),e.jsx(n,{estado:u,cambiarEstado:E,tipo:"text",label:"Nombre De Usuario",placeholder:"Introduzca El Nombre De Usuario",name:"NombreUsuario",leyendaError:"El Nombre del Usuario solo puede contener letras y espacios.",expresionRegular:t.NombreUsuario}),e.jsx(n,{estado:m,cambiarEstado:j,tipo:"number",label:"Rol",placeholder:"Introduzca El Rol",name:"Rol",leyendaError:"El rol solo puede contener numeros",expresionRegular:t.Rol}),e.jsx(n,{estado:p,cambiarEstado:g,tipo:"email",label:"Correo",placeholder:"Introduzca El Correo Electronico",name:"Correo",leyendaError:"El Formato Del Correo No Es Valido",expresionRegular:t.Correo}),e.jsx(n,{estado:h,cambiarEstado:N,tipo:"password",label:"Clave",placeholder:"Introduzca La Contrasena",name:"Clave",leyendaError:"La contrasena debe contener minimo 8 caracteres",expresionRegular:t.Clave})]})})})]}),e.jsx(A,{titulo:"Insertar",formularioValido:q,onCancel:I,onSubmit:le})]}),fe=e.jsxs("div",{style:k,children:[e.jsx("h3",{children:"Editar Usuario"}),e.jsxs("div",{className:"relleno-general",children:["General",e.jsx("div",{className:"container-fluid",children:e.jsx(P,{children:e.jsxs(Z,{children:[e.jsx(n,{estado:d,cambiarEstado:f,tipo:"text",label:"Nombre",placeholder:"Introduzca El Nombre",name:"Nombre",leyendaError:"El Nombre solo puede contener letras y espacios.",expresionRegular:t.Nombre,value:d.campo}),e.jsx(n,{estado:u,cambiarEstado:E,tipo:"text",label:"Nombre De Usuario",placeholder:"Introduzca El Nombre De Usuario",name:"NombreUsuario",leyendaError:"El Nombre del Usuario solo puede contener letras y espacios.",expresionRegular:t.NombreUsuario,value:u.campo}),e.jsx(n,{estado:m,cambiarEstado:j,tipo:"number",label:"Rol",placeholder:"Introduzca El Rol",name:"Rol",leyendaError:"El rol solo puede contener números",expresionRegular:t.Rol,value:m.campo}),e.jsx(n,{estado:p,cambiarEstado:g,tipo:"email",label:"Correo",placeholder:"Introduzca El Correo Electrónico",name:"Correo",leyendaError:"El Formato Del Correo No Es Válido",expresionRegular:t.Correo,value:p.campo})]})})})]}),e.jsx(A,{titulo:"Editar",formularioValido:q,onCancel:z,onSubmit:ie})]}),Ee=e.jsxs("div",{style:k,children:[e.jsx("h3",{children:"Eliminar Usuario"}),e.jsxs("div",{className:"relleno-general",children:[" ","General",e.jsx("div",{className:"container-fluid",children:e.jsx(P,{children:e.jsxs(Z,{children:[e.jsxs("h4",{children:["Codigo: ",c.campo]}),e.jsxs("h4",{children:["Nombre: ",d.campo]}),e.jsxs("h4",{children:["Nombre De Usuario: ",u.campo]}),e.jsxs("h4",{children:["Rol: ",m.campo]}),e.jsxs("h4",{children:["Correo: ",p.campo]})]})})})]}),e.jsx(A,{titulo:"Eliminar",onCancel:S,onSubmit:me})]}),je=e.jsxs("div",{style:k,children:[e.jsx("div",{className:"relleno-general",children:e.jsx("div",{className:"container-fluid",children:e.jsx(P,{children:e.jsxs(Ne,{children:[e.jsx(n,{estado:h,cambiarEstado:N,tipo:"password",label:"Contraseña Actual",placeholder:"Introduzca la contraseña actual",name:"Clave",leyendaError:"La contraseña actual es requerida",expresionRegular:t.Clave,value:h.campo,onChange:K,onBlur:K}),e.jsx(n,{estado:F,cambiarEstado:W,tipo:"password",label:"Nueva Contraseña",placeholder:"Introduzca la nueva contraseña",name:"NuevaClave",leyendaError:"La contraseña debe tener al menos 8 caracteres",expresionRegular:t.Clave,value:F.campo}),e.jsx(n,{estado:U,cambiarEstado:ee,tipo:"password",label:"Confirmar Nueva Contraseña",placeholder:"Confirme la nueva contraseña",name:"ConfirmarNuevaClave",leyendaError:"Las contraseñas no coinciden",expresionRegular:t.Clave,value:U.campo})]})})})}),e.jsx(A,{titulo:"Cambiar Clave",formularioValido:q,onCancel:D,onSubmit:ce})]});return e.jsxs("div",{className:"Cliente",children:[e.jsx("div",{className:"banner",children:e.jsx("h3",{children:e.jsx("b",{children:"200-Mantenimiento Usuarios"})})}),e.jsx("div",{className:"btn-agrega",children:e.jsx(G,{startIcon:e.jsx(ze,{}),onClick:()=>I(),children:"Agregar Usuario"})}),e.jsx("br",{}),e.jsx("br",{}),e.jsx(Ue,{columns:Ae,data:y,title:"Usuarios",actions:[{icon:Se,tooltip:"Modificar Modificar",onClick:(o,a)=>H(a,"Editar")},{icon:De,tooltip:"Eliminar Usuario",onClick:(o,a)=>H(a,"Eliminar")},{icon:ke,tooltip:"Cambiar Contrasena",onClick:(o,a)=>H(a,"CambioClave")}],options:{actionsColumnIndex:-1,exportButton:!0,columnsButton:!0,headerStyle:{backgroundColor:"lightgrey"},selection:!0,showTextRowSelected:!1,showSelectedAllheckbox:!1,searchFieldAligment:"left",showtitle:!1},localization:{header:{actions:"Acciones"},toolbar:{searchPlaceholder:"Busqueda"}}}),e.jsx(L,{open:Q,onClose:I,children:e.jsx(e.Fragment,{children:ve})}),e.jsx(L,{open:O,onClose:z,children:e.jsx(e.Fragment,{children:fe})}),e.jsx(L,{open:V,onClose:S,children:e.jsx(e.Fragment,{children:Ee})}),e.jsx(L,{open:X,onClose:D,children:e.jsx(e.Fragment,{children:je})})]})};export{Te as default};
