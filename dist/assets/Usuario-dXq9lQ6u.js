import{q as Ne,j as e,r as s,a8 as k,a4 as G,ae as Ue,a6 as ge,a9 as x,a7 as C,ab as ye,ac as Ie,ad as Re,aa as B}from"./index-i6cV1Y3u.js";import{I as n,A as ze,E as we,D as Se,f as De}from"./InputGeneral-CaHIVkyX.js";import{n as T,M as L}from"./Modal-y4NBJ25E.js";const Ae=Ne(e.jsx("path",{d:"M2 17h20v2H2zm1.15-4.05L4 11.47l.85 1.48 1.3-.75-.85-1.48H7v-1.5H5.3l.85-1.47L4.85 7 4 8.47 3.15 7l-1.3.75.85 1.47H1v1.5h1.7l-.85 1.48zm6.7-.75 1.3.75.85-1.48.85 1.48 1.3-.75-.85-1.48H15v-1.5h-1.7l.85-1.47-1.3-.75L12 8.47 11.15 7l-1.3.75.85 1.47H9v1.5h1.7zM23 9.22h-1.7l.85-1.47-1.3-.75L20 8.47 19.15 7l-1.3.75.85 1.47H17v1.5h1.7l-.85 1.48 1.3.75.85-1.48.85 1.48 1.3-.75-.85-1.48H23z"}),"Password"),Me=[{title:"Codigo",field:"id"},{title:"Nombre",field:"nombre"},{title:"Nombre De Usuario",field:"nombreUsuario"},{title:"Rol",field:"rol",type:"numeric"},{title:"Correo",field:"correo"}],Pe="http://190.113.84.163:8000/Usuario/RecUsuario",ke="http://190.113.84.163:8000/Usuario/InsUsuario",Be="http://190.113.84.163:8000/Usuario/ModUsuario",Le="http://190.113.84.163:8000/Usuario/DelUsuario",Fe="http://190.113.84.163:8000/Usuario/RecUsuarioXId",$e="http://190.113.84.163:8000/Usuario/ValidarUsuarioLogin",He="http://190.113.84.163:8000/Usuario/ModClaveUsuario",Ve=()=>{const l={campo:"",valido:null},[c,v]=s.useState(l),[d,E]=s.useState(l),[u,j]=s.useState(l),[m,f]=s.useState({campo:0,valido:null}),[p,N]=s.useState(l),[h,U]=s.useState(l),[F,W]=s.useState(l),[g,ee]=s.useState(l),[$,V]=s.useState(!1),[y,I]=s.useState([]),[q,oe]=s.useState(!1),[Q,ae]=s.useState(!1),[O,re]=s.useState(!1),[X,se]=s.useState(!1),t={Id:/^[0-9]*$/,Nombre:/^[a-zA-Z0-9_-\s]{1,40}$/,NombreUsuario:/^[a-zA-Z0-9_-\s]{1,40}$/,Rol:/^[1-9]$/,Correo:/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/,Clave:/^(?=(?:.*[A-Za-z]){4,})(?=.*[A-Z])(?=(?:.*\d){4,})[A-Za-z\d]{8,}$/},te=()=>{v(l),E(l),j(l),f({campo:0,valido:null}),N(l),U(l)},ne=o=>o.every(a=>a.valido==="true"),H=(o,a,r)=>{o.preventDefault(),ne(r)?(V(!0),te(),a()):V(!1)},le=o=>H(o,de,[c,d,u,m,p,h]),ie=o=>H(o,ue,[c,d,u,m,p]),ce=o=>H(o,pe,[h,F,g]),_=async(o,a,r,i,b)=>{try{const P=await C.post(o,a);if(b==="id"){if(P.data===null)return;r({campo:"",valido:"false"}),x.fire({icon:"error",title:"Cuidado",text:i})}else if(b==="clave")if(P.data===null)r({campo:"",valido:"null"}),x.fire({icon:"error",title:"Cuidado",text:i});else return}catch(P){console.error("Error:",P)}},J=()=>{const o={id:c.campo,nombre:"",nombreUsuario:"",rol:0,correo:"",clave:""};_(Fe,o,v,"Código Usuario Existente, Intente Nuevamente","id")},Y=()=>{const o={id:c.campo,nombre:"",nombreUsuario:"",rol:0,correo:"",clave:h.campo};_($e,o,U,"Contraseña incorrecta, Intente Nuevamente","clave")},de=()=>R("Desea Guardar Los Cambios?",be),ue=()=>R("Desea Editar Los Cambios?",he),me=()=>R("Desea Eliminar Los Cambios?",xe),pe=()=>R("Desea Cambiar la Contraseña?",Ce),R=(o,a)=>{x.fire({title:o,showDenyButton:!0,confirmButtonText:"Confirmar",denyButtonText:"Cancelar"}).then(r=>{r.isConfirmed?(x.fire("Operacion Exitosa","","success"),a()):r.isDenied&&x.fire("Cambios No Guardados","","info")})},be=async()=>{const o=B();if(!o)return;const a={Id:c.campo,Nombre:d.campo,NombreUSuario:u.campo,Rol:m.campo,Correo:p.campo,Clave:h.campo};try{const r=await C.post(ke,a,{headers:{Authorization:`Bearer ${o}`}});I([...y,r.data]),z()}catch(r){console.error("Error en la peticion Post: ",r)}},he=async()=>{const o=B();if(!o)return;console.log("este es el token ",o);const a={id:c.campo,nombre:d.campo,nombreUsuario:u.campo,rol:m.campo,correo:p.campo};try{const r=await C.put(Be,a,{headers:{Authorization:`Bearer ${o}`}}),i=y.map(b=>b.id===a.id?a:b);I(i),w()}catch(r){console.error("Error En La Peticion Put: ",r)}},xe=async()=>{const o=B();if(!o)return;const a=c.campo,r={headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`},data:JSON.stringify(a)};try{await C.delete(Le,r),I(y.filter(i=>i.Id!==c.campo)),S(),K()}catch(i){console.error("Error Al Eliminar Usuario: ",i)}},Z=async(o,a)=>{const r=Object.values(...o);v({campo:r[0],valido:"true"}),E({campo:r[1],valido:"true"}),j({campo:r[2],valido:"true"}),f({campo:r[3],valido:"true"}),N({campo:r[4],valido:"true"}),a==="Editar"?w():a==="Eliminar"?S():D()},K=async()=>{try{const o=await C.get(Pe,{withCredentials:!0});I(o.data),console.log("Datos Recibidos: ",o.data)}catch(o){o.response?(console.error("Error de respuesta del servidor:",o.response.status,o.response.data),o.response.status===401&&console.warn("No autorizado. Redirigiendo al login...")):o.request?console.error("Error en la solicitud:",o.request):console.error("Error al configurar la solicitud:",o.message)}};s.useEffect(()=>{K()},[]);const Ce=async()=>{const o=B();if(!o)return;function a(){x.fire({icon:"error",title:"Cuidado",text:"No fue posible actualizar la contrasena"})}function r(){x.fire({icon:"success",title:"Exitos",text:"Contrasena Actualizada Exitosamente"})}const i={Id:c.campo,Clave:g.campo,Rol:0,Nombre:"",NombreUsuario:"",Correo:""};try{(await C.put(He,i,{headers:{Authorization:`Bearer ${o}`}})).status===200?(r(),D()):a()}catch(b){console.error("Error al actualizar la contraseña:",b),a()}},z=()=>{oe(!q)},w=()=>{ae(!Q)},S=()=>{re(!O)},D=()=>{se(!X)},A={width:"70%",height:"100%",overflowX:"hidden",overflowY:"scroll",position:"relative",backgroundColor:"rgb(255, 255, 255)"},M=({titulo:o,formularioValido:a,onCancel:r,onSubmit:i})=>e.jsxs(e.Fragment,{children:[a===!1&&e.jsx(ye,{children:e.jsxs("p",{children:[e.jsx(Ie,{icon:De}),e.jsx("b",{children:"Error:"})," Por favor rellena el formulario correctamente."]})}),a===!0&&e.jsx(Re,{children:"Campos llenos exitosamente!"}),e.jsxs("div",{align:"right",children:[e.jsx(T,{color:"success",onClick:r,children:"Cancelar"}),e.jsx(T,{color:"primary",onClick:i,type:"submit",children:o})]})]}),ve=e.jsxs("div",{style:A,children:[e.jsx("h3",{children:"Incluir Usuario v2"}),e.jsxs("div",{className:"relleno-general",children:[" ","General",e.jsx("div",{className:"container-fluid",children:e.jsx(k,{children:e.jsxs(G,{children:[e.jsx(n,{estado:c,cambiarEstado:v,tipo:"text",label:"Id Usuario",placeholder:"Introduzca Id Del Usuario",name:"Id",leyendaError:"El Id Del Usuario solo puede contener numeros.",expresionRegular:t.Id,onChange:J,onBlur:J,autofocus:!0}),e.jsx(n,{estado:d,cambiarEstado:E,tipo:"text",label:"Nombre",placeholder:"Introduzca El Nombre",name:"Nombre",leyendaError:"El Nombre solo puede contener letras y espacios.",expresionRegular:t.Nombre}),e.jsx(n,{estado:u,cambiarEstado:j,tipo:"text",label:"Nombre De Usuario",placeholder:"Introduzca El Nombre De Usuario",name:"NombreUsuario",leyendaError:"El Nombre del Usuario solo puede contener letras y espacios.",expresionRegular:t.NombreUsuario}),e.jsx(n,{estado:m,cambiarEstado:f,tipo:"number",label:"Rol",placeholder:"Introduzca El Rol",name:"Rol",leyendaError:"El rol solo puede contener numeros",expresionRegular:t.Rol}),e.jsx(n,{estado:p,cambiarEstado:N,tipo:"email",label:"Correo",placeholder:"Introduzca El Correo Electronico",name:"Correo",leyendaError:"El Formato Del Correo No Es Valido",expresionRegular:t.Correo}),e.jsx(n,{estado:h,cambiarEstado:U,tipo:"password",label:"Clave",placeholder:"Introduzca La Contrasena",name:"Clave",leyendaError:"La contrasena debe contener minimo 8 caracteres",expresionRegular:t.Clave})]})})})]}),e.jsx(M,{titulo:"Insertar",formularioValido:$,onCancel:z,onSubmit:le})]}),Ee=e.jsxs("div",{style:A,children:[e.jsx("h3",{children:"Editar Usuario"}),e.jsxs("div",{className:"relleno-general",children:["General",e.jsx("div",{className:"container-fluid",children:e.jsx(k,{children:e.jsxs(G,{children:[e.jsx(n,{estado:d,cambiarEstado:E,tipo:"text",label:"Nombre",placeholder:"Introduzca El Nombre",name:"Nombre",leyendaError:"El Nombre solo puede contener letras y espacios.",expresionRegular:t.Nombre,value:d.campo}),e.jsx(n,{estado:u,cambiarEstado:j,tipo:"text",label:"Nombre De Usuario",placeholder:"Introduzca El Nombre De Usuario",name:"NombreUsuario",leyendaError:"El Nombre del Usuario solo puede contener letras y espacios.",expresionRegular:t.NombreUsuario,value:u.campo}),e.jsx(n,{estado:m,cambiarEstado:f,tipo:"number",label:"Rol",placeholder:"Introduzca El Rol",name:"Rol",leyendaError:"El rol solo puede contener números",expresionRegular:t.Rol,value:m.campo}),e.jsx(n,{estado:p,cambiarEstado:N,tipo:"email",label:"Correo",placeholder:"Introduzca El Correo Electrónico",name:"Correo",leyendaError:"El Formato Del Correo No Es Válido",expresionRegular:t.Correo,value:p.campo})]})})})]}),e.jsx(M,{titulo:"Editar",formularioValido:$,onCancel:w,onSubmit:ie})]}),je=e.jsxs("div",{style:A,children:[e.jsx("h3",{children:"Eliminar Usuario"}),e.jsxs("div",{className:"relleno-general",children:[" ","General",e.jsx("div",{className:"container-fluid",children:e.jsx(k,{children:e.jsxs(G,{children:[e.jsxs("h4",{children:["Codigo: ",c.campo]}),e.jsxs("h4",{children:["Nombre: ",d.campo]}),e.jsxs("h4",{children:["Nombre De Usuario: ",u.campo]}),e.jsxs("h4",{children:["Rol: ",m.campo]}),e.jsxs("h4",{children:["Correo: ",p.campo]})]})})})]}),e.jsx(M,{titulo:"Eliminar",onCancel:S,onSubmit:me})]}),fe=e.jsxs("div",{style:A,children:[e.jsx("div",{className:"relleno-general",children:e.jsx("div",{className:"container-fluid",children:e.jsx(k,{children:e.jsxs(Ue,{children:[e.jsx(n,{estado:h,cambiarEstado:U,tipo:"password",label:"Contraseña Actual",placeholder:"Introduzca la contraseña actual",name:"Clave",leyendaError:"La contraseña actual es requerida",expresionRegular:t.Clave,value:h.campo,onChange:Y,onBlur:Y}),e.jsx(n,{estado:F,cambiarEstado:W,tipo:"password",label:"Nueva Contraseña",placeholder:"Introduzca la nueva contraseña",name:"NuevaClave",leyendaError:"La contraseña debe tener al menos 8 caracteres",expresionRegular:t.Clave,value:F.campo}),e.jsx(n,{estado:g,cambiarEstado:ee,tipo:"password",label:"Confirmar Nueva Contraseña",placeholder:"Confirme la nueva contraseña",name:"ConfirmarNuevaClave",leyendaError:"Las contraseñas no coinciden",expresionRegular:t.Clave,value:g.campo})]})})})}),e.jsx(M,{titulo:"Cambiar Clave",formularioValido:$,onCancel:D,onSubmit:ce})]});return e.jsxs("div",{className:"Cliente",children:[e.jsx("div",{className:"banner",children:e.jsx("h3",{children:e.jsx("b",{children:"200-Mantenimiento Usuarios"})})}),e.jsx("div",{className:"btn-agrega",children:e.jsx(T,{startIcon:e.jsx(ze,{}),onClick:()=>z(),children:"Agregar Usuario"})}),e.jsx("br",{}),e.jsx("br",{}),e.jsx(ge,{columns:Me,data:y,title:"Usuarios",actions:[{icon:we,tooltip:"Modificar Modificar",onClick:(o,a)=>Z(a,"Editar")},{icon:Se,tooltip:"Eliminar Usuario",onClick:(o,a)=>Z(a,"Eliminar")},{icon:Ae,tooltip:"Cambiar Contrasena",onClick:(o,a)=>Z(a,"CambioClave")}],options:{actionsColumnIndex:-1,exportButton:!0,columnsButton:!0,headerStyle:{backgroundColor:"lightgrey"},selection:!0,showTextRowSelected:!1,showSelectedAllheckbox:!1,searchFieldAligment:"left",showtitle:!1},localization:{header:{actions:"Acciones"},toolbar:{searchPlaceholder:"Busqueda"}}}),e.jsx(L,{open:q,onClose:z,children:e.jsx(e.Fragment,{children:ve})}),e.jsx(L,{open:Q,onClose:w,children:e.jsx(e.Fragment,{children:Ee})}),e.jsx(L,{open:O,onClose:S,children:e.jsx(e.Fragment,{children:je})}),e.jsx(L,{open:X,onClose:D,children:e.jsx(e.Fragment,{children:fe})})]})};export{Ve as default};
