import{t as Ne,j as e,r as s,L as B,I as G,U as Ue,M as ge,S as x,O as v,K as C,P as ye,Q as Ie,R as ze}from"./index-C9xMqd9z.js";import{I as n,j as T,M as L,k as we}from"./InputGeneral-Do5fAD7f.js";import{A as Re,E as Se,D as De}from"./Edit-B-lilJ91.js";const ke=Ne(e.jsx("path",{d:"M2 17h20v2H2zm1.15-4.05L4 11.47l.85 1.48 1.3-.75-.85-1.48H7v-1.5H5.3l.85-1.47L4.85 7 4 8.47 3.15 7l-1.3.75.85 1.47H1v1.5h1.7l-.85 1.48zm6.7-.75 1.3.75.85-1.48.85 1.48 1.3-.75-.85-1.48H15v-1.5h-1.7l.85-1.47-1.3-.75L12 8.47 11.15 7l-1.3.75.85 1.47H9v1.5h1.7zM23 9.22h-1.7l.85-1.47-1.3-.75L20 8.47 19.15 7l-1.3.75.85 1.47H17v1.5h1.7l-.85 1.48 1.3.75.85-1.48.85 1.48 1.3-.75-.85-1.48H23z"}),"Password"),Ae=[{title:"Codigo",field:"id"},{title:"Nombre",field:"nombre"},{title:"Nombre De Usuario",field:"nombreUsuario"},{title:"Rol",field:"rol",type:"numeric"},{title:"Correo",field:"correo"}],Me="https://loteriabackapi.azurewebsites.net/api/Usuario/RecUsuario",Pe="https://loteriabackapi.azurewebsites.net/api/Usuario/InsUsuario",Be="https://loteriabackapi.azurewebsites.net/api/Usuario/ModUsuario",Le="https://loteriabackapi.azurewebsites.net/api/Usuario/DelUsuario",Fe="https://loteriabackapi.azurewebsites.net/api/Usuario/RecUsuarioXId",$e="https://loteriabackapi.azurewebsites.net/api/ValidarUsuarioLogin",He="https://loteriabackapi.azurewebsites.net/api/Usuario/ModClaveUsuario",Oe=()=>{const i={campo:"",valido:null},[c,E]=s.useState(i),[d,j]=s.useState(i),[u,f]=s.useState(i),[m,N]=s.useState({campo:0,valido:null}),[p,U]=s.useState(i),[h,g]=s.useState(i),[F,W]=s.useState(i),[y,ee]=s.useState(i),[$,O]=s.useState(!1),[I,z]=s.useState([]),[Q,oe]=s.useState(!1),[V,ae]=s.useState(!1),[q,re]=s.useState(!1),[X,se]=s.useState(!1),t={Id:/^[0-9]*$/,Nombre:/^[a-zA-Z0-9_-\s]{1,40}$/,NombreUsuario:/^[a-zA-Z0-9_-\s]{1,40}$/,Rol:/^[1-9]$/,Correo:/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/,Clave:/^(?=(?:.*[A-Za-z]){4,})(?=.*[A-Z])(?=(?:.*\d){4,})[A-Za-z\d]{8,}$/},te=()=>{E(i),j(i),f(i),N({campo:0,valido:null}),U(i),g(i)},ne=o=>o.every(a=>a.valido==="true"),H=(o,a,r)=>{o.preventDefault(),ne(r)?(O(!0),te(),a()):O(!1)},ie=o=>H(o,de,[c,d,u,m,p,h]),le=o=>H(o,ue,[c,d,u,m,p]),ce=o=>H(o,pe,[h,F,y]),_=async(o,a,r,l,b)=>{try{const P=await C.post(o,a);if(b==="id"){if(P.data===null)return;r({campo:"",valido:"false"}),x.fire({icon:"error",title:"Cuidado",text:l})}else if(b==="clave")if(P.data===null)r({campo:"",valido:"null"}),x.fire({icon:"error",title:"Cuidado",text:l});else return}catch(P){console.error("Error:",P)}},J=()=>{const o={id:c.campo,nombre:"",nombreUsuario:"",rol:0,correo:"",clave:""};_(Fe,o,E,"Código Usuario Existente, Intente Nuevamente","id")},K=()=>{const o={id:c.campo,nombre:"",nombreUsuario:"",rol:0,correo:"",clave:h.campo};_($e,o,g,"Contraseña incorrecta, Intente Nuevamente","clave")},de=()=>w("Desea Guardar Los Cambios?",be),ue=()=>w("Desea Editar Los Cambios?",he),me=()=>w("Desea Eliminar Los Cambios?",xe),pe=()=>w("Desea Cambiar la Contraseña?",Ce),w=(o,a)=>{x.fire({title:o,showDenyButton:!0,confirmButtonText:"Confirmar",denyButtonText:"Cancelar"}).then(r=>{r.isConfirmed?(x.fire("Operacion Exitosa","","success"),a()):r.isDenied&&x.fire("Cambios No Guardados","","info")})},be=async()=>{const o=v();if(!o)return;const a={Id:c.campo,Nombre:d.campo,NombreUSuario:u.campo,Rol:m.campo,Correo:p.campo,Clave:h.campo};try{const r=await C.post(Pe,a,{headers:{Authorization:`Bearer ${o}`}});r.status===200?(z([...I,r.data]),R()):(console.error("Error en la respuesta del servidor",r),alert("Ocurrió un error en la solicitud."))}catch(r){console.error("Error en la peticion Post: ",r),alert("Error durante la petición. Intenta nuevamente.")}},he=async()=>{const o=v();if(!o)return;console.log("este es el token ",o);const a={id:c.campo,nombre:d.campo,nombreUsuario:u.campo,rol:m.campo,correo:p.campo};try{const r=await C.put(Be,a,{headers:{Authorization:`Bearer ${o}`}}),l=I.map(b=>b.id===a.id?a:b);z(l),S()}catch(r){console.error("Error En La Peticion Put: ",r)}},xe=async()=>{const o=v();if(!o)return;const a=c.campo,r={headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`},data:JSON.stringify(a)};try{await C.delete(Le,r),z(I.filter(l=>l.Id!==c.campo)),D(),Y()}catch(l){console.error("Error Al Eliminar Usuario: ",l)}},Z=async(o,a)=>{const r=Object.values(...o);E({campo:r[0],valido:"true"}),j({campo:r[1],valido:"true"}),f({campo:r[2],valido:"true"}),N({campo:r[3],valido:"true"}),U({campo:r[4],valido:"true"}),a==="Editar"?S():a==="Eliminar"?D():k()},Y=async()=>{const o=v();if(o){console.log("Este es el token de vueta : ",o);try{const a=await C.get(Me,{headers:{Authorization:`Bearer ${o}`}});z(a.data),console.log("Datos Recibidos: ",a.data)}catch(a){a.response?(console.error("Error de respuesta del servidor:",a.response.status,a.response.data),a.response.status===401&&console.warn("No autorizado. Redirigiendo al login...")):a.request?console.error("Error en la solicitud:",a.request):console.error("Error al configurar la solicitud:",a.message)}}};s.useEffect(()=>{Y()},[]);const Ce=async()=>{const o=v();if(!o)return;function a(){x.fire({icon:"error",title:"Cuidado",text:"No fue posible actualizar la contrasena"})}function r(){x.fire({icon:"success",title:"Exitos",text:"Contrasena Actualizada Exitosamente"})}const l={Id:c.campo,Clave:y.campo,Rol:0,Nombre:"",NombreUsuario:"",Correo:""};try{(await C.put(He,l,{headers:{Authorization:`Bearer ${o}`}})).status===200?(r(),k()):a()}catch(b){console.error("Error al actualizar la contraseña:",b),a()}},R=()=>{oe(!Q)},S=()=>{ae(!V)},D=()=>{re(!q)},k=()=>{se(!X)},A={width:"70%",height:"100%",overflowX:"hidden",overflowY:"scroll",position:"relative",backgroundColor:"rgb(255, 255, 255)"},M=({titulo:o,formularioValido:a,onCancel:r,onSubmit:l})=>e.jsxs(e.Fragment,{children:[a===!1&&e.jsx(ye,{children:e.jsxs("p",{children:[e.jsx(Ie,{icon:we}),e.jsx("b",{children:"Error:"})," Por favor rellena el formulario correctamente."]})}),a===!0&&e.jsx(ze,{children:"Campos llenos exitosamente!"}),e.jsxs("div",{align:"right",children:[e.jsx(T,{color:"success",onClick:r,children:"Cancelar"}),e.jsx(T,{color:"primary",onClick:l,type:"submit",children:o})]})]}),ve=e.jsxs("div",{style:A,children:[e.jsx("h3",{children:"Incluir Usuario v2"}),e.jsxs("div",{className:"relleno-general",children:[" ","General",e.jsx("div",{className:"container-fluid",children:e.jsx(B,{children:e.jsxs(G,{children:[e.jsx(n,{estado:c,cambiarEstado:E,tipo:"text",label:"Id Usuario",placeholder:"Introduzca Id Del Usuario",name:"Id",leyendaError:"El Id Del Usuario solo puede contener numeros.",expresionRegular:t.Id,onChange:J,onBlur:J,autofocus:!0}),e.jsx(n,{estado:d,cambiarEstado:j,tipo:"text",label:"Nombre",placeholder:"Introduzca El Nombre",name:"Nombre",leyendaError:"El Nombre solo puede contener letras y espacios.",expresionRegular:t.Nombre}),e.jsx(n,{estado:u,cambiarEstado:f,tipo:"text",label:"Nombre De Usuario",placeholder:"Introduzca El Nombre De Usuario",name:"NombreUsuario",leyendaError:"El Nombre del Usuario solo puede contener letras y espacios.",expresionRegular:t.NombreUsuario}),e.jsx(n,{estado:m,cambiarEstado:N,tipo:"number",label:"Rol",placeholder:"Introduzca El Rol",name:"Rol",leyendaError:"El rol solo puede contener numeros",expresionRegular:t.Rol}),e.jsx(n,{estado:p,cambiarEstado:U,tipo:"email",label:"Correo",placeholder:"Introduzca El Correo Electronico",name:"Correo",leyendaError:"El Formato Del Correo No Es Valido",expresionRegular:t.Correo}),e.jsx(n,{estado:h,cambiarEstado:g,tipo:"password",label:"Clave",placeholder:"Introduzca La Contrasena",name:"Clave",leyendaError:"La contrasena debe contener minimo 8 caracteres",expresionRegular:t.Clave})]})})})]}),e.jsx(M,{titulo:"Insertar",formularioValido:$,onCancel:R,onSubmit:ie})]}),Ee=e.jsxs("div",{style:A,children:[e.jsx("h3",{children:"Editar Usuario"}),e.jsxs("div",{className:"relleno-general",children:["General",e.jsx("div",{className:"container-fluid",children:e.jsx(B,{children:e.jsxs(G,{children:[e.jsx(n,{estado:d,cambiarEstado:j,tipo:"text",label:"Nombre",placeholder:"Introduzca El Nombre",name:"Nombre",leyendaError:"El Nombre solo puede contener letras y espacios.",expresionRegular:t.Nombre,value:d.campo}),e.jsx(n,{estado:u,cambiarEstado:f,tipo:"text",label:"Nombre De Usuario",placeholder:"Introduzca El Nombre De Usuario",name:"NombreUsuario",leyendaError:"El Nombre del Usuario solo puede contener letras y espacios.",expresionRegular:t.NombreUsuario,value:u.campo}),e.jsx(n,{estado:m,cambiarEstado:N,tipo:"number",label:"Rol",placeholder:"Introduzca El Rol",name:"Rol",leyendaError:"El rol solo puede contener números",expresionRegular:t.Rol,value:m.campo}),e.jsx(n,{estado:p,cambiarEstado:U,tipo:"email",label:"Correo",placeholder:"Introduzca El Correo Electrónico",name:"Correo",leyendaError:"El Formato Del Correo No Es Válido",expresionRegular:t.Correo,value:p.campo})]})})})]}),e.jsx(M,{titulo:"Editar",formularioValido:$,onCancel:S,onSubmit:le})]}),je=e.jsxs("div",{style:A,children:[e.jsx("h3",{children:"Eliminar Usuario"}),e.jsxs("div",{className:"relleno-general",children:[" ","General",e.jsx("div",{className:"container-fluid",children:e.jsx(B,{children:e.jsxs(G,{children:[e.jsxs("h4",{children:["Codigo: ",c.campo]}),e.jsxs("h4",{children:["Nombre: ",d.campo]}),e.jsxs("h4",{children:["Nombre De Usuario: ",u.campo]}),e.jsxs("h4",{children:["Rol: ",m.campo]}),e.jsxs("h4",{children:["Correo: ",p.campo]})]})})})]}),e.jsx(M,{titulo:"Eliminar",onCancel:D,onSubmit:me})]}),fe=e.jsxs("div",{style:A,children:[e.jsx("div",{className:"relleno-general",children:e.jsx("div",{className:"container-fluid",children:e.jsx(B,{children:e.jsxs(Ue,{children:[e.jsx(n,{estado:h,cambiarEstado:g,tipo:"password",label:"Contraseña Actual",placeholder:"Introduzca la contraseña actual",name:"Clave",leyendaError:"La contraseña actual es requerida",expresionRegular:t.Clave,value:h.campo,onChange:K,onBlur:K}),e.jsx(n,{estado:F,cambiarEstado:W,tipo:"password",label:"Nueva Contraseña",placeholder:"Introduzca la nueva contraseña",name:"NuevaClave",leyendaError:"La contraseña debe tener al menos 8 caracteres",expresionRegular:t.Clave,value:F.campo}),e.jsx(n,{estado:y,cambiarEstado:ee,tipo:"password",label:"Confirmar Nueva Contraseña",placeholder:"Confirme la nueva contraseña",name:"ConfirmarNuevaClave",leyendaError:"Las contraseñas no coinciden",expresionRegular:t.Clave,value:y.campo})]})})})}),e.jsx(M,{titulo:"Cambiar Clave",formularioValido:$,onCancel:k,onSubmit:ce})]});return e.jsxs("div",{className:"Cliente",children:[e.jsx("div",{className:"banner",children:e.jsx("h3",{children:e.jsx("b",{children:"200-Mantenimiento Usuarios"})})}),e.jsx("div",{className:"btn-agrega",children:e.jsx(T,{startIcon:e.jsx(Re,{}),onClick:()=>R(),children:"Agregar Usuario"})}),e.jsx("br",{}),e.jsx("br",{}),e.jsx(ge,{columns:Ae,data:I,title:"Usuarios",actions:[{icon:Se,tooltip:"Modificar Modificar",onClick:(o,a)=>Z(a,"Editar")},{icon:De,tooltip:"Eliminar Usuario",onClick:(o,a)=>Z(a,"Eliminar")},{icon:ke,tooltip:"Cambiar Contrasena",onClick:(o,a)=>Z(a,"CambioClave")}],options:{actionsColumnIndex:-1,exportButton:!0,columnsButton:!0,headerStyle:{backgroundColor:"lightgrey"},selection:!0,showTextRowSelected:!1,showSelectedAllheckbox:!1,searchFieldAligment:"left",showtitle:!1},localization:{header:{actions:"Acciones"},toolbar:{searchPlaceholder:"Busqueda"}}}),e.jsx(L,{open:Q,onClose:R,children:e.jsx(e.Fragment,{children:ve})}),e.jsx(L,{open:V,onClose:S,children:e.jsx(e.Fragment,{children:Ee})}),e.jsx(L,{open:q,onClose:D,children:e.jsx(e.Fragment,{children:je})}),e.jsx(L,{open:X,onClose:k,children:e.jsx(e.Fragment,{children:fe})})]})};export{Oe as default};
